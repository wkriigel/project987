# **987 Project v2 — Restart Kit (Process \+ Strategy \+ Product Values)**

## **Product goals & values**

* **Primary goal:** surface undervalued **Porsche 987.2 (2009–2012)** listings.

* **Ranking signal:** **Deal Delta ($)** \= how far **under** (or **over**) fair a car is after adjusting price for market factors.

* **Your values:** Automatic (PDK/Tiptronic) prioritized; interior tan/brown preferred (subjective, not priced-in by default); colors matter (exterior color carries market value); simplicity, speed, and explainability over features.

* **Budget context:** most real candidates in the **$20k–$36k** window; we’ll tune weights from real runs.

## **Scope (MVP)**

* Start with **Cars.com** only (others stubbed; Carvana next).

* **Headful Playwright** scraping (reliability \> speed; learned from v1).

* Input \= **AutoTempest** search URL(s). Example default:

  * `https://www.autotempest.com/results?localization=country&make=porsche&maxyear=2012&minyear=2009&model=cayman&transmission=auto&zip=30214`

* **Always fresh scrape** → timestamped CSV; processing reads **latest** file.

* **Manual CSVs**: ingest **all** in `input/manual/` (same schema).

* **Debug ON** by default; **cap listings** per run (default 150).

* **One combined table**: **Automatic** rows first, then **Manual** → sort by **Deal Δ ($) desc**, then **Price asc**.

* No colorized UI initially (leave hooks).

## **Scoring model (dollar-based)**

Compute **Adjusted Price** (all values configurable, human-friendly):

 adj\_price \= list\_price  
          \- s\_premium\_usd\*(is S)  
          \- per\_option\_usd\*(\# of top-5)  
          \- exterior\_color\_usd\*(ext is color)  
          \- per\_year\_usd\*(year \- 2009\)  
          \- interior\_color\_usd\*(int is color)   \# default 0  
          \- special\_trim\_premium\_usd\*(if Cayman R or Boxster Spyder)  \# default 30,000

*   
* **Baseline**: median `adj_price` within `(model, transmission_norm, mileage_band)`  
   Bands: `0–39,999`, `40–59,999`, `60–79,999`, `80–99,999`, `≥100k`.

* **Deal Δ ($)**: `baseline_adj_price - adj_price` (positive \= good).

* **Transmission normalization (view)**: `PDK/Tiptronic/Auto` → **“Automatic”**, else **“Manual”**.

* **Top-5 options** (simple substring/synonyms initially):  
   `Sport Chrono, PASM, PSE, LSD, Sport Seats`.

* **Body styles:** Boxster & Cayman treated **equal** (no extra USD).

* **Accident/Title, dealer/private, photos, outlier guards, multi-currency:** **not** in MVP.

## **Data model (CSV → stable)**

Columns include (not exhaustive):  
 `timestamp_run_id, source (cars.com|carvana|...), listing_url, vin, year, model, trim, transmission_norm, transmission_raw, mileage, price_usd, exterior_color, interior_color, color_ext_bucket, color_int_bucket, raw_options (semicolon list), top5_options_count, top5_options_present, location, adj_price_usd, baseline_adj_price_usd, deal_delta_usd`

**View columns (order):** **Deal Δ ($)** | **Price** | **Miles** | **Year/Model/Trim** | **Transmission** | **Colors (Ext / Int)** | **Top Options** | **Source**  
 *(View-only: Price/Miles rounded **up** to nearest 1k; CSV stays exact.)*

## **Configuration (human-friendly, persistent)**

* **Lives outside the code** (so nuking code won’t touch your settings).

* Keys you’ll edit:

  * `search_urls` (AutoTempest)

  * `min_year, max_year`

  * `fair_value`:

    * `s_premium_usd` (default 6000\)

    * `per_option_usd` (default 500\)

    * `exterior_color_usd` (default 1000\)

    * `interior_color_usd` (default 0\)

    * `per_year_usd` (default 500\)

    * `special_trim_premiums = { "Cayman R": 30000, "Boxster Spyder": 30000 }`

  * `concurrency, polite_delay_ms, cap_listings, debug`

  * `top5_options.list` (names/variants)

* Defaults are **commented** and **plain-English**. You’ll paste back updated configs if you want new defaults.

## **File layout (nuke-safe)**

x987-app/            \# throwaway code folder (safe to delete/replace)  
  x987/              \# package code (small modules; contracts in headers)  
  scripts/           \# setup.ps1/.bat, map.py  
  tests/, docs/, rules/ (default rule seeds)

%APPDATA%/x987/      \# persistent user state (never delete)  
  config.toml  
  rules/             \# your overrides (colors/options synonyms)  
  input/manual/      \# manual CSVs (merged automatically)  
  fixtures/          \# saved HTML for offline tests  
  backups/

x987-data/           \# outputs (regenerated each run)  
  raw/ (timestamped scrape CSVs \+ latest.csv)  
  normalized/ (timestamped scored CSVs \+ latest.csv)  
  meta/ (run\_meta\_\*.json)

## **Development process (tight iterations, low friction)**

* **Sole engineer** (me) \+ **designer** (you). I deliver **complete, runnable** drops with install/run/debug docs and pinned deps.

* **Iteration protocol (one-change rule):**  
   I preface each change with: *Intent, Files touched, Contracts impacted, Acceptance criteria, Rollback steps*.  
   You reply with a short bug template (Observed vs Expected, Repro, Artifacts, Priority).

* **Contracts-first headers** in every file: `PROVIDES / DEPENDS / CONSUMED BY / CONTRACT / TECH CHOICE / RISK / TODO(NEXT)`.

* **Doctor preflight** runs first when `debug=true` (deps, Playwright, config, folders).

* **Fixtures-first & “dry mode”**: we parse saved Cars.com HTML snapshots before touching the network; golden CSV/table detect regressions.

* **Deterministic artifacts \+ “latest” alias**: you only need to share `x987-data/normalized/latest.csv` and the console tail.

* **Small files, small diffs**: most modules ≤ \~150 LoC; full-file replacements for easy copy/paste.

## **Install / run / debug (what every code drop will include)**

* **Setup:** `scripts/setup.ps1` (PowerShell) or `.bat`  
   → creates venv, installs pinned deps, installs Chromium, verifies.

* **Run:** `python -m x987`  
   → doctor → collect (AT) → scrape (cars.com) → transform → dedupe → fairvalue → baseline → rank → view.

* **Outputs:** terminal table \+ `x987-data/normalized/latest.csv` (+ timestamped history).

* **Debug tips:** stage banners/timings, top drop reasons, per-row “explain” string for Adjusted Price & Delta math.

## **Acceptance tests (MVP)**

1. Setup & doctor succeed on Windows.

2. Config loads from persistent path; default AT URL present.

3. **Fixtures** parse; golden outputs match.

4. Live scrape of \~20 listings completes; runtime \~**5 min** (tune via config).

5. VIN dedupe keeps **most complete** record.

6. Transmission shows **Automatic** (normalized) & **Manual**; table is **Automatic first**.

7. Sort among equal-delta rows is **Price asc**.

8. CSV includes `source` and `location`; schema matches spec.

9. Rerun writes new timestamped files and updates `latest.csv`.

## **Transparency policy (standing)**

* **Assumptions explicit**, **no false certainty**, **Risks \+ mitigations** included, **confidence** labeled (low/med/high).

* Code carries `# WHY`, `# RISK`, `# TODO(NEXT)`, `# TECH CHOICE` breadcrumbs; docs keep a **Decision Log** and **Change Log**.

---

### **Current assumptions & risks (pre-code)**

* **Assumptions:** Windows 10 \+ PowerShell; Python 3.10–3.12; headful Chromium runs; AutoTempest & Cars.com allow headful navigation at conservative pacing.

* **Risks:** Site DOM/anti-bot changes; option/color text variance; USD weights drift with market.

* **Mitigations:** per-site scrapers (tiny), fixtures \+ golden outputs, simple substring rules (expandable), weights in config.

* **Confidence:** Process/design **high**; first live-selectors **medium** until we test once.

---

